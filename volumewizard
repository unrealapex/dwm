#!/bin/sh

if [ ! "$NO_COLOR" = 1 ]; then
  bold="\033[1m"
  reset="\033[m"
else
  bold=""
  reset=""
fi

if ! command -v wpctl > /dev/null || ! command -v herbe; then
  if  ! command -v wpctl && ! command -v herbe; then
    error "wireplumber and herbe not found"
  elif  ! command -v wpctl; then
    error "wireplumber not found"
  elif ! command -v herbe; then
    error "wireplumber not found"
  fi
  exit
fi


send_notification() {
  volume=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | tr -dc '0-9' | sed 's/^0\{1,2\}//')
  if wpctl get-volume @DEFAULT_AUDIO_SINK@ | grep -q "MUTED"; then
    env HERBE_ID=/9993 herbe "volume: muted"
  else
    env HERBE_ID=/9993 herbe "volume: $volume%"
  fi
}

case $1 in
up)
  # Set the volume on (if it was muted)
  wpctl set-mute @DEFAULT_AUDIO_SINK@ 0
  wpctl set-volume @DEFAULT_AUDIO_SINK@ 2%+

  ;;
down)
  wpctl set-mute @DEFAULT_AUDIO_SINK@ 0
  wpctl set-volume @DEFAULT_AUDIO_SINK@ 2%-
  ;;
mute)
  wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
  ;;
info)
  wpctl status
  ;;
*)
  printf "%b" "${bold}volumewizard${reset}: volume control wrapper for wpctl

${bold}Usage${reset}: volumewizard [up|down|mute|info]
" >&2
  exit
  ;;
esac

send_notification
